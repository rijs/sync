var sync=function(){"use strict";function n(n){return function(t){return t==n}}function t(n){return function(t){return h(t)(n)}}function e(n,t,r,i){var u=r.shift();if(!C[t])return!1;if(r.length){if(!(u in n)){if("remove"==t)return!0;n[u]={}}return e(n[u],t,r,i)}return C[t](n,u,i),!0}var r=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},i=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},u=function(n,t){return t in n},o=function(n,t,e,r){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(e=t,t=t.name),!u(n,t)&&Object.defineProperty(n,t,{value:e,writable:r}),n[t]},c=function n(t){function e(n,e){return n.next?n.next(e):e instanceof Array?n.apply(t,e):n.call(t,e)}function u(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||n.splice(e,1)}function c(t,e){var i=n((e=e||{}).base||r());return i.i=0,i.li=[],i.fn=e.fn,i.parent=t,i.source=e.fn?i.parent.source:i,i.on("stop",function(){return i.type?i.parent.off(i.type,i):i.parent.off(i)}),i.each=function(n){var t=n.next?n:c(i,{fn:n});return i.li.push(t),t},i.pipe=function(n){return n(i)},i.map=function(n){return i.each(function(t,e,r){return r.next(n(t,e,r))})},i.filter=function(n){return i.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},i.reduce=function(n,t){return i.each(function(e,r,i){return i.next(t=n(t,e,r,i))})},i.unpromise=function(){var n=c(i,{base:{},fn:function(t){return n.next(t)}});return i.li.push(n),n},i.next=function(n){return i.resolve&&i.resolve(n),i.li.length?i.li.map(function(t){return t.fn(n,t.i++,t)}):n},i.until=function(n){return n.each(function(){i.source.emit("stop")}),i},i.off=function(n){return u(i.li,n),i},i[Symbol.asyncIterator]=function(){return{next:function(){return i.wait=new Promise(function(n){i.wait=!0,i.map(function(t,e,r){delete i.wait,i.off(r),n({value:t,done:!1})}),i.emit("pull",i)})}}},i}return t=t||{},o(t,"emit",function(n,r,u){for(var o=t.on[n.split(".")[0]]||[],c=[],f=0;f<o.length;f++)o[f].ns&&u&&!u(o[f].ns)||c.push(e(o[f].isOnce?o.splice(f--,1)[0]:o[f],r));for(f=0;f<t.on["*"].length;f++)c.push(e(t.on["*"][f],[n,r]));return c.reduce(i,[])},1),o(t,"once",function(n,e){return t.on(n,e,!0)},1),o(t,"off",function(n,e){return u(t.on[n]||[],e),e&&e.ns&&delete t.on[n]["$"+e.ns],t},1),o(t,"on",function(n,e,r){function i(n){return n.isOnce=r,n.type=o,f&&(t.on[o]["$"+(n.ns=f)]=n),a.push(n),n.next?n:t}var o=n.split(".")[0],f=n.split(".")[1],a=t.on[o]=t.on[o]||[],s="function"==typeof e?e:0;return!s&&f?(s=t.on[o]["$"+f])?s:i(c(t,e)):s||f?s&&f?i((u(a,t.on[o]["$"+f]||-1),s)):!(!s||f)&&i(s):i(c(t,e))},1),t.on["*"]=t.on["*"]||[],t},f=function(n){void 0===n&&(n=location.href.replace("http","ws"));var t=c({attempt:0});return t.ready=t.once("connected"),t.connect=l(t,n),t.connect(),t.send=function(n){return t.ready.then(function(t){return t.send(n)})},t},a=Math.min,s=Math.pow,l=function(n,t){return function(){var e=window.WebSocket,r=window.setTimeout,i=new e(t);i.onopen=function(){return n.emit("connected",i)},i.onmessage=function(t){return n.emit("recv",t.data)},i.onclose=function(){n.ready=n.once("connected"),n.emit("disconnected"),r(n.connect,p(++n.attempt))}}},p=function(n,t,e){return void 0===t&&(t=100),void 0===e&&(e=1e4),a(e,t*s(2,n))},d=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return"object"==typeof n&&!(n instanceof Array)},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(t){return!!n&&(n.indexOf?~n.indexOf(t):t in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};var m=function(n){return Object.keys(d.obj(n)||d.fn(n)?n:{})},v=function(n){return n.__data__},y=function(n){return function(){return n}},b=function(n){return 0===n?"0":n?d.fn(n)?""+n:d.obj(n)?JSON.stringify(n):String(n):""},h=function n(t,e){var r=arguments.length>1,i=d.fn(t)?[]:b(t).split("."),u=i.shift();return function(o,c){var f={};return o?d.num(t)||t?d.arr(t)?(t.map(function(t){var e=n(t)(o);void 0!=e&&n(t,d.fn(e)?y(e):e)(f)}),f):o[t]||!i.length?r?(o[t]=d.fn(e)?e(o[t],c):e,o):d.fn(t)?t(o):o[t]:r?(n(i.join("."),e)(o[u]?o[u]:o[u]={}),o):n(i.join("."))(o[u]):o:void 0}},g=t;t.parent=function(n){return v(this.parentNode)[n]};var x=function(n){return n?m(n).map(g(n)):[]},O=function(n){void 0===n&&(n={});var t=n.socket;return void 0===t&&(t=f()),t.id=0,t.once("disconnected").map(function(){return t.on("connected").map(w(t))}),t.on("recv").map(function(n){return j(n)}).each(function(n){var e=n.id,r=n.data;return r.exec?r.exec(t.on["$"+e]&&t.on["$"+e][0],r.value):t.emit("$"+e,r)}),Object.defineProperty(S(t),"subscriptions",{get:function(){return _(t)}})},_=function(n){return x(n.on).map(function(n){return n&&n[0]}).filter(function(n){return n&&n.type&&"$"==n.type[0]})},w=function(n){return function(){return _(n).map(function(n){return n.type}).map(function(t){return n.send(n.on[t][0].subscription)})}},j=function(n,t){return t={exports:{}},n(t,t.exports),t.exports}(function(n){!function(){function t(n){return"object"==typeof n?null===n?"null":n&&1===n.nodeType?"dom":n instanceof Array?"array":n instanceof Date?"date":"object":typeof n}function e(n){var t=arguments,e=arguments.length;if(e<2||null==n)return n;for(var r=1;r<e;r++)for(var i=t[r],u=Object.keys(i),o=u.length,c=0;c<o;c++){var f=u[c];void 0===n[f]&&(n[f]=i[f])}return n}function r(n,e,i,c){i.prepare&&i.prepare(n),c=c||[];var f=t(n);if(-1!==s.indexOf(f)){var a=c.indexOf(n);if(-1===a){var p={};c[a=e.push({contents:p,value:o(n)})-1]=n;for(var d in n)i.isSerializable(n,d)&&(p[d]=r(n[d],e,i,c))}return l+a}return u(n)}function i(n,t,e,r){if(r=r||[],a(n,l)){var u=parseInt(n.slice(l.length),10);if(!r.hasOwnProperty(u)){var o=t[u],s=c(o.value),p=o.contents;r[u]=s;for(var d in p)s[d]=i(p[d],t,e,r)}return e.finalize&&e.finalize(r[u]),r[u]}return e.finalize&&e.finalize(n),f(n)}function u(n){var e=t(n);if("undefined"===e)return m;if("function"===e)return d+n.toString();if("date"===e)return v+n.getTime();if(n===1/0)return p;if("dom"!==e)return n}function o(n){var e=t(n);return"function"===e||"date"===e?u(n):"object"===e?y:"array"===e?b:n}function c(n){if("string"===t(n)){if(n===m)return;if(a(n,d))return new Function("return "+n.slice(d.length))();if(a(n,v)){var e=parseInt(n.slice(v.length),10);return new Date(e)}if(a(n,y))return{};if(a(n,b))return[];if(n===p)return 1/0}return n}function f(n){if("string"===t(n)){if(n===m)return;if(a(n,d)){var e=n.slice(d.length),r=e.indexOf("(")+1,i=e.indexOf(")",r),u=e.slice(r,i),o=e.indexOf("{")+1,c=e.lastIndexOf("}")-1,f=e.slice(o,c);return new Function(u,f)}if(a(n,v)){var s=parseInt(n.slice(v.length),10);return new Date(s)}if(n===p)return 1/0}return n}function a(n,e){return"string"===t(n)&&n.slice(0,e.length)===e}var s="object array date function".split(" "),l="_CRYO_REF_",p="_CRYO_INFINITY_",d="_CRYO_FUNCTION_",m="_CRYO_UNDEFINED_",v="_CRYO_DATE_",y="_CRYO_OBJECT_",b="_CRYO_ARRAY_",h={stringify:function(n,t){var i=[],u=r(n,i,t=e((t="function"==typeof t?{prepare:t}:t)||{},{prepare:null,isSerializable:function(n,t){return n.hasOwnProperty(t)}}));return JSON.stringify({root:u,references:i})},parse:function(n,t){var r=JSON.parse(n);return t="function"==typeof t?{finalize:t}:t,t=e(t||{},{finalize:null}),i(r.root,r.references,t)}},g=this;n.exports?n.exports=h:g.Cryo=h}()}).parse,S=function(n,t){return function(e,r){if(e instanceof window.Blob)return z(n,e,r);var i=b(++n.id),u=n.on("$"+i),o=function(e,r){return void 0===r&&(r=0),n.send(u.source.subscription=b({id:i,data:e,type:t})).then(function(){return u.emit("sent",{id:i,count:r})})};return e.next?e.map(o).source.emit("start"):o(e),u.source.once("stop").filter(function(n){return"CLOSED"!=n}).map(function(){return S(n,"UNSUBSCRIBE")(i).filter(function(n,t,e){return e.source.emit("stop","CLOSED")})}),u}},z=function(n,t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=1024);var u=c().on("recv"),o=function(e){return function(){return r>=t.size?u.emit("sent",{id:e}):(n.send(t.slice(r,r+=i)),window.setTimeout(o(e)))}};return S(n,"BINARY")({size:t.size,meta:e}).on("sent",function(n){var t=n.id;return o(t)()}).on("progress",function(n){return u.emit("progress",{received:n,total:t.size})}).map(u.next).source.until(u.once("stop")),u},N={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function t(n,t,r){return 0===r&&(n={}),n[d.fn(e)?e(t,r):t[e]]=t,n}var e="id";return 1==arguments.length?(e=n,t):t.apply(this,arguments)}},C={add:function(n,t,e){d.arr(n)?n.splice(t,0,e):n[t]=e},update:function(n,t,e){n[t]=e},remove:function(n,t){d.arr(n)?n.splice(t,1):delete n[t]}},R=JSON.stringify,I=JSON.parse,A=function(n,t){return function(r,i,u){if(!d.obj(r)&&!d.fn(r))return r;if(!d.obj(n)){var f=i||r.log||[],a=r;if(d.def(u)||(u=f.max||0),u||(f=[]),u<0&&(f=f.concat(null)),u>0){var s=R(r);a=I(s),f=f.concat({type:"update",value:I(s),time:f.length})}return o(f,"max",u),a.log?a.log=f:o(c(a),"log",f,1),a}return!!d.def(n.key)&&(!!e(r,n.type,(n.key=""+n.key).split("."),n.value)&&(r.log&&r.log.max&&r.log.push((n.time=r.log.length,r.log.max>0?n:null)),!t&&r.emit&&r.emit("change",n),r))}},P=function(n){return function(){return!n.apply(this,arguments)}},E=function(n,t){return function(e){return t[e]=n[e],e}},Y=function(n){return function(t){return m(t).filter(P(d.in(n))).map(E(t,n)),n}},B=function(n){return function(t,e,r){return t instanceof Blob?n(t,e):n(d.obj(t)?t:{name:t,type:e,value:r})}},D=function(n){return function(t,e){if(n.subscriptions[t]=n.subscriptions[t]||{},d.arr(e))return Promise.all(e.map(function(e){return n.get(t,e)}));var r=h(e)(h("resources."+t+".body")(n));return e in n.subscriptions[t]&&r?Promise.resolve(r):n.subscribe(t,e).filter(function(n,t,e){return e.source.emit("stop")}).map(function(){return h(e)(h("resources."+t+".body")(n))})}},$=function(n,t){return function(e){return e.key||"update"!=e.type?A(e)(t in n.resources?n(t):n(t,{})):n(J(Y({name:t})(e))),e}},k=function(n){var t=c().on("next"),e=[];return n.map(function(n,r){return n.each(function(n){e[r]=n,t.next(e)})}),t.once("stop").map(function(){return n.map(function(n){return n.source.emit("stop")})}),t},T=function(n){return function(t,e){if(d.arr(t))return k(t.map(function(t){return n.subscribe(t,e)}));if(n.subscriptions[t]=n.subscriptions[t]||{},d.arr(e))return k(e.map(function(e){return n.subscribe(t,e)})).map(function(){return h(e)(n(t))});var r=c().on("next");r.on("stop").filter(function(){return console.log("before",i.li.length),i.off(r.next),console.log("after",i.li.length),!i.li.length}).map(function(){return i.source.emit("stop")}).map(function(){n.subscriptions[t][e]=void 0}),n.subscriptions[t][e]&&r.on("start").map(function(r){return r.send(h(e)(n(t)))});var i=n.subscriptions[t][e]=n.subscriptions[t][e]||n.send(t,"SUBSCRIBE",e).map($(n,t)).map(function(){return h(e)(n(t))});return i.each(r.next),r}},F=function(n){return function(t,e){var r=++n.upload.id,u={},o=0,c=function(){if(!f.length)return!0;var t=f.shift(),e=t.field,i=t.filename,u=t.i,s=t.blob;return n.send(s,{filename:i,field:e,i:u,index:r}).on("progress",function(n){var t=n.received;return a.emit("progress",{total:o,received:o-(s.size-t)-f.reduce(function(n,t){return n+=t.blob.size},0)})}).then(c)},f=m(e).map(function(n){return u[n]=e[n],n}).filter(function(n){return e[n]instanceof FileList}).map(function(n){return u[n]=[],N.arr(e[n]).map(function(n){return o+=n.size,n}).map(function(t,e){return{field:n,filename:t.name,i:e,blob:t,sent:0}})}).reduce(i,[]),a=n.send({files:f.length,type:"PREUPLOAD",resource:t,fields:u,index:r,size:o}).once("sent",c);return a}},J=function(n){var t=n.name,e=n.value;return{name:t,headers:n.headers,body:e}},U=function(n){return function(t){return function(e){return!n.deps(e).filter(P(d.in(n.subscriptions))).map(function(t){return n.subscribe(t)}).length&&t(e)}}},L=function(n){return function(t){return x(n.types).filter(function(n){return n.extract}).map(function(n){return n.extract(t)}).reduce(function(n,t){return n.concat(t)},[]).filter(Boolean)}};return function(n,t,e){void 0===t&&(t={}),void 0===e&&(e={});var r=e.xrs;return void 0===r&&(r=O),n.send=B(r()),n.subscribe=T(n),n.subscriptions={},n.get=D(n),n.upload=F(n),n.upload.id=0,n.render=U(n)(n.render),n.deps=L(n),n}}();
